(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{6601:function(){},3397:function(e,t,r){"use strict";r.d(t,{F:function(){return s},f:function(){return o}});var n=r(7437),i=r(2265);let a=(0,i.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,i.useState)("dark"),[s,l]=(0,i.useState)(!1);(0,i.useEffect)(()=>{l(!0);let e=localStorage.getItem("agentmemory-theme");e?(o(e),document.documentElement.setAttribute("data-theme",e)):document.documentElement.setAttribute("data-theme","dark")},[]);let c=e=>{o(e),localStorage.setItem("agentmemory-theme",e),document.documentElement.setAttribute("data-theme",e)};return s?(0,n.jsx)(a.Provider,{value:{theme:r,toggleTheme:()=>{c("dark"===r?"light":"dark")},setTheme:c},children:t}):(0,n.jsx)("div",{style:{visibility:"hidden"},children:t})}function s(){let e=(0,i.useContext)(a);return void 0===e?{theme:"dark",toggleTheme:()=>{},setTheme:()=>{}}:e}},783:function(e,t,r){"use strict";r.d(t,{d:function(){return y},m:function(){return f}});var n=r(7437),i=r(2265),a=r(5960),o=r(3008),s=r(1981),l=r(2894),c=r(4056),u=r(2549);let m={success:o.Z,error:s.Z,warning:l.Z,info:c.Z},d={success:"border-[#4ade80] text-[#4ade80] bg-[#4ade80]/10",error:"border-[#ff4444] text-[#ff4444] bg-[#ff4444]/10",warning:"border-[#fbbf24] text-[#fbbf24] bg-[#fbbf24]/10",info:"border-[#00d4ff] text-[#00d4ff] bg-[#00d4ff]/10"};function f(){let e=(0,a.zn)(),{remove:t}=(0,a.$b)();return(0,n.jsx)("div",{className:"fixed top-4 right-4 z-50 flex flex-col gap-2 max-w-sm",children:e.map(e=>(0,n.jsx)(g,{notification:e,onClose:()=>t(e.id)},e.id))})}function g(e){let{notification:t,onClose:r}=e,a=m[t.type],o=d[t.type];return(0,i.useEffect)(()=>{if(t.duration&&t.duration>0){let e=setTimeout(r,t.duration);return()=>clearTimeout(e)}},[t.duration,r]),(0,n.jsx)("div",{className:"p-4 border ".concat(o," shadow-lg animate-in slide-in-from-right duration-300"),role:"alert",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)(a,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("h4",{className:"font-mono font-bold text-sm",children:t.title}),(0,n.jsx)("p",{className:"text-xs text-[#888] mt-1",children:t.message}),t.action&&(0,n.jsx)("button",{onClick:t.action.onClick,className:"mt-2 text-xs font-mono underline hover:no-underline opacity-80 hover:opacity-100",children:t.action.label})]}),(0,n.jsx)("button",{onClick:r,className:"flex-shrink-0 opacity-60 hover:opacity-100 transition-opacity",children:(0,n.jsx)(u.Z,{className:"w-4 h-4"})})]})})}function y(){let{add:e}=(0,a.$b)(),t=(0,i.useCallback)((t,r,n,i)=>{var a;e({type:t,title:r,message:n,duration:null!==(a=null==i?void 0:i.duration)&&void 0!==a?a:5e3,action:null==i?void 0:i.action})},[e]),r=(0,i.useCallback)((e,r,n)=>{t("success",e,r,n)},[t]);return{success:r,error:(0,i.useCallback)((e,r,n)=>{var i;t("error",e,r,{...n,duration:null!==(i=null==n?void 0:n.duration)&&void 0!==i?i:8e3})},[t]),warning:(0,i.useCallback)((e,r,n)=>{t("warning",e,r,n)},[t]),info:(0,i.useCallback)((e,r,n)=>{t("info",e,r,n)},[t]),notify:t}}},5960:function(e,t,r){"use strict";r.d(t,{$b:function(){return d},Hj:function(){return o},Oh:function(){return u},Z:function(){return c},gL:function(){return m},qr:function(){return a},rV:function(){return s},zn:function(){return l}});var n=r(4660),i=r(4810);let a=(0,n.Ue)()((0,i.tJ)((e,t)=>({wallet:{connected:!1,publicKey:null,connecting:!1,disconnecting:!1},setWalletConnected:(t,r)=>e(e=>({wallet:{...e.wallet,connected:t,publicKey:r}})),setWalletConnecting:t=>e(e=>({wallet:{...e.wallet,connecting:t}})),setWalletDisconnecting:t=>e(e=>({wallet:{...e.wallet,disconnecting:t}})),vault:{vault:null,profile:null,exists:!1,loading:!1,error:null},setVault:t=>e(e=>({vault:{...e.vault,vault:t,exists:!!t}})),setProfile:t=>e(e=>({vault:{...e.vault,profile:t}})),setVaultExists:t=>e(e=>({vault:{...e.vault,exists:t}})),setVaultLoading:t=>e(e=>({vault:{...e.vault,loading:t}})),setVaultError:t=>e(e=>({vault:{...e.vault,error:t}})),resetVault:()=>e(e=>({vault:{vault:null,profile:null,exists:!1,loading:!1,error:null}})),memories:{memories:new Map,lastFetch:0,isStale:!0},addMemory:(t,r)=>e(e=>{let n=new Map(e.memories.memories);return n.set(t,r),{memories:{...e.memories,memories:n}}}),removeMemory:t=>e(e=>{let r=new Map(e.memories.memories);return r.delete(t),{memories:{...e.memories,memories:r}}}),updateMemory:(t,r)=>e(e=>{let n=new Map(e.memories.memories);return n.set(t,r),{memories:{...e.memories,memories:n}}}),setMemories:t=>e(e=>{let r=new Map;return t.forEach(e=>{r.set(e.key,e)}),{memories:{memories:r,lastFetch:Date.now(),isStale:!1}}}),markMemoriesStale:()=>e(e=>({memories:{...e.memories,isStale:!0}})),clearMemories:()=>e(e=>({memories:{memories:new Map,lastFetch:0,isStale:!0}})),transactions:[],addTransaction:t=>e(e=>({transactions:[{...t,timestamp:Date.now()},...e.transactions.slice(0,49)]})),updateTransaction:(t,r)=>e(e=>({transactions:e.transactions.map(e=>e.id===t?{...e,...r}:e)})),removeTransaction:t=>e(e=>({transactions:e.transactions.filter(e=>e.id!==t)})),clearTransactions:()=>e({transactions:[]}),getPendingTransactions:()=>t().transactions.filter(e=>"pending"===e.status),client:null,setClient:t=>e({client:t}),isInitializing:!1,setIsInitializing:t=>e({isInitializing:t}),notifications:[],addNotification:t=>e(e=>({notifications:[{...t,id:"notif_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),timestamp:Date.now()},...e.notifications.slice(0,9)]})),removeNotification:t=>e(e=>({notifications:e.notifications.filter(e=>e.id!==t)})),clearNotifications:()=>e({notifications:[]})}),{name:"agent-memory-storage",storage:(0,i.FL)(()=>localStorage),partialize:e=>{var t;return{wallet:{connected:e.wallet.connected,publicKey:(null===(t=e.wallet.publicKey)||void 0===t?void 0:t.toBase58())||null,connecting:!1,disconnecting:!1},transactions:[]}}})),o=()=>a(e=>e.vault),s=()=>{let e=a(e=>e.memories);return{memories:Array.from(e.memories.values()),lastFetch:e.lastFetch,isStale:e.isStale}},l=()=>a(e=>e.notifications),c=()=>{let e=a();return{setConnected:e.setWalletConnected,setConnecting:e.setWalletConnecting,setDisconnecting:e.setWalletDisconnecting}},u=()=>{let e=a();return{setVault:e.setVault,setProfile:e.setProfile,setExists:e.setVaultExists,setLoading:e.setVaultLoading,setError:e.setVaultError,reset:e.resetVault}},m=()=>{let e=a();return{add:e.addMemory,remove:e.removeMemory,update:e.updateMemory,setAll:e.setMemories,markStale:e.markMemoriesStale,clear:e.clearMemories}},d=()=>{let e=a();return{add:e.addNotification,remove:e.removeNotification,clear:e.clearNotifications}}},6211:function(e,t,r){"use strict";r.d(t,{Ct:function(){return c},N8:function(){return o},d5:function(){return u}});var n=r(3438),i=r(2601),a=r(7133).Buffer;let o=new n.PublicKey(i.env.NEXT_PUBLIC_PROGRAM_ID||"Memo111111111111111111111111111111111111111"),s={initializeVault:a.from([26,139,76,125,158,47,90,60]),createMemory:a.from([43,156,93,142,31,106,75,125]),deleteMemory:a.from([60,173,110,159,42,123,92,142]),updateProfile:a.from([77,190,127,26,59,140,109,159]),updateMemory:a.from([94,207,138,43,76,157,126,26])},l={maxRetries:3,retryDelayMs:1e3,backoffMultiplier:1.5};class c{onTransactionStatus(e,t){this.transactionCallbacks.set(e,t)}notifyStatus(e,t){let r=this.transactionCallbacks.get(e);r&&r(t)}findVaultPda(e,t){return n.PublicKey.findProgramAddressSync([a.from("vault"),e.toBuffer(),t.toBuffer()],this.programId)}findProfilePda(e){return n.PublicKey.findProgramAddressSync([a.from("profile"),e.toBuffer()],this.programId)}findMemoryPda(e,t){return n.PublicKey.findProgramAddressSync([a.from("memory"),e.toBuffer(),a.from(t)],this.programId)}serializeMetadata(e){let t=a.from(e.tags.join(",")),r=e.ipfsCid?a.from(e.ipfsCid):a.alloc(0);return a.concat([a.from([{conversation:0,learning:1,preference:2,task:3,relationship:4,knowledge:5,system:6}[e.memoryType]]),a.from([e.importance]),a.from(new Uint32Array([t.length]).buffer),t,a.from(new Uint32Array([r.length]).buffer),r])}async withRetry(e,t){let r;let i=this.retryConfig.retryDelayMs;for(let a=0;a<=this.retryConfig.maxRetries;a++)try{return await e()}catch(e){if(r=e,e instanceof n.SendTransactionError)throw e;a<this.retryConfig.maxRetries&&(console.warn("".concat(t," failed (attempt ").concat(a+1,"), retrying in ").concat(i,"ms...")),await new Promise(e=>setTimeout(e,i)),i*=this.retryConfig.backoffMultiplier)}throw r}async sendAndConfirmTransaction(e,t,r){return this.withRetry(async()=>{try{let{blockhash:r,lastValidBlockHeight:n}=await this.connection.getLatestBlockhash();e.recentBlockhash=r,e.feePayer=t[0].publicKey,t.length>0&&e.sign(...t);let i=e.serialize(),a=await this.connection.sendRawTransaction(i,{skipPreflight:!1,preflightCommitment:this.commitment,maxRetries:3});this.notifyStatus(a,"sent");let o=await this.connection.confirmTransaction({signature:a,blockhash:r,lastValidBlockHeight:n},this.commitment);if(o.value.err)throw Error("Transaction failed: ".concat(o.value.err));return this.notifyStatus(a,"confirmed"),{signature:a,success:!0,confirmationStatus:this.commitment}}catch(e){return{signature:"",success:!1,error:e instanceof Error?e.message:"Unknown error"}}},"sendAndConfirmTransaction")}async initializeVault(e,t,r,i){let[o]=this.findVaultPda(e,t),[l]=this.findProfilePda(t),c=await this.connection.getMinimumBalanceForRentExemption(256),u=await this.connection.getMinimumBalanceForRentExemption(512),m=new n.Transaction,d=n.SystemProgram.createAccount({fromPubkey:i.publicKey,newAccountPubkey:o,lamports:c,space:256,programId:this.programId}),f=n.SystemProgram.createAccount({fromPubkey:i.publicKey,newAccountPubkey:l,lamports:u,space:512,programId:this.programId}),g=new n.TransactionInstruction({keys:[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:i.publicKey,isSigner:!0,isWritable:!0}],programId:this.programId,data:a.concat([s.initializeVault,a.from(r)])});return m.add(d,f,g),{vault:o,profile:l,result:await this.sendAndConfirmTransaction(m,[i])}}async createMemory(e,t,r,i,o,l,c){let[u]=this.findMemoryPda(t,r),m=await this.connection.getMinimumBalanceForRentExemption(1024),d=new n.Transaction,f=n.SystemProgram.createAccount({fromPubkey:c.publicKey,newAccountPubkey:u,lamports:m,space:1024,programId:this.programId}),g=this.serializeMetadata(l),y=new n.TransactionInstruction({keys:[{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:n.SystemProgram.programId,isSigner:!1,isWritable:!1}],programId:this.programId,data:a.concat([s.createMemory,a.from(r),a.from(i),a.from(new Uint32Array([o]).buffer),g])});return d.add(f,y),{memoryPda:u,result:await this.sendAndConfirmTransaction(d,[c])}}async storeMemory(e,t,r,n,i,a,o){return arguments.length>7&&void 0!==arguments[7]&&arguments[7],this.createMemory(e,t,r,n,i,a,o)}async deleteMemory(e,t,r,i){let[o]=this.findMemoryPda(t,r),l=new n.Transaction,c=new n.TransactionInstruction({keys:[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:i.publicKey,isSigner:!0,isWritable:!0}],programId:this.programId,data:a.concat([s.deleteMemory,a.from(r)])});return l.add(c),await this.sendAndConfirmTransaction(l,[i])}async updateProfile(e,t,r,i,o){let l=new n.Transaction,c=i.name?a.from(i.name):a.alloc(0),u=i.capabilities?a.from(i.capabilities.join(",")):a.alloc(0),m=new n.TransactionInstruction({keys:[{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!1}],programId:this.programId,data:a.concat([s.updateProfile,a.from([i.name?1:0]),a.from(new Uint32Array([c.length]).buffer),c,a.from([i.capabilities?1:0]),a.from(new Uint32Array([u.length]).buffer),u,a.from([void 0!==i.isPublic?1:0]),a.from([i.isPublic?1:0])])});return l.add(m),await this.sendAndConfirmTransaction(l,[o])}async updateMemory(e,t,r,i,o,l,c){let[u]=this.findMemoryPda(t,r),m=new n.Transaction,d=this.serializeMetadata(l),f=new n.TransactionInstruction({keys:[{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!0,isWritable:!1}],programId:this.programId,data:a.concat([s.updateMemory,a.from(r),a.from(i),a.from(new Uint32Array([o]).buffer),d])});return m.add(f),{memoryPda:u,result:await this.sendAndConfirmTransaction(m,[c])}}async getMemoryShard(e){return this.withRetry(async()=>{let t=await this.connection.getAccountInfo(e);return t?this.parseMemoryShard(t.data,e):null},"getMemoryShard")}async getVault(e){return this.withRetry(async()=>{let t=await this.connection.getAccountInfo(e);return t?this.parseVault(t.data,e):null},"getVault")}async getAgentProfile(e){return this.withRetry(async()=>{let t=await this.connection.getAccountInfo(e);return t?this.parseProfile(t.data,e):null},"getAgentProfile")}async vaultExists(e,t){let[r]=this.findVaultPda(e,t);return null!==await this.connection.getAccountInfo(r)}async listMemories(e){return this.withRetry(async()=>(await this.connection.getProgramAccounts(this.programId,{filters:[{memcmp:{offset:0,bytes:e.toBase58()}}]})).map(e=>e.pubkey),"listMemories")}async getMultipleMemoryShards(e){return this.withRetry(async()=>(await this.connection.getMultipleAccountsInfo(e)).map((t,r)=>t?this.parseMemoryShard(t.data,e[r]):null),"getMultipleMemoryShards")}parseMemoryShard(e,t){try{let t,r=8,i=new n.PublicKey(e.slice(r,r+32));r+=32;let a=e.readUInt32LE(r);r+=4;let o=e.slice(r,r+a).toString("utf-8");r+=a;let s=new Uint8Array(e.slice(r,r+32));r+=32;let l=e.readUInt32LE(r);r+=4;let c=1===e[r],u=e[r+=1],m=["conversation","learning","preference","task","relationship","knowledge","system"],d=m[u]||"conversation",f=e[r+=1];r+=1;let g=e.readUInt32LE(r);r+=4;let y=e.slice(r,r+g).toString("utf-8"),h=y?y.split(","):[];r+=g;let p=BigInt(e.readBigUInt64LE(r));r+=8;let b=BigInt(e.readBigUInt64LE(r));r+=8;let w=e.readUInt32LE(r);r+=4;let I=1===e[r];r+=1;let k=1===e[r];r+=1,k&&(t=BigInt(e.readBigUInt64LE(r)),r+=8);let v=e.readUInt32LE(r);r+=4;let S=[];for(let t=0;t<v;t++){let t=e.readUInt32LE(r);r+=4;let n=new Uint8Array(e.slice(r,r+32));r+=32;let i=e.readUInt32LE(r),a=e[r+=4],o=e[r+=1];r+=1;let s=BigInt(e.readBigUInt64LE(r));r+=8,S.push({version:t,contentHash:n,contentSize:i,metadata:{memoryType:m[a]||"conversation",importance:o,tags:[]},createdAt:s})}let M=e[r];return{vault:i,key:o,contentHash:s,contentSize:l,isEncrypted:c,metadata:{memoryType:d,importance:f,tags:h},createdAt:p,updatedAt:b,version:w,isDeleted:I,deletedAt:t,versionHistory:S,bump:M}}catch(e){throw console.error("Error parsing memory shard:",e),Error("Failed to parse memory shard data")}}parseVault(e,t){try{let t=8,r=new n.PublicKey(e.slice(t,t+32));t+=32;let i=new n.PublicKey(e.slice(t,t+32));t+=32;let a=new Uint8Array(e.slice(t,t+32));t+=32;let o=BigInt(e.readBigUInt64LE(t));t+=8;let s=BigInt(e.readBigUInt64LE(t));t+=8;let l=e.readUInt32LE(t);t+=4;let c=BigInt(e.readBigUInt64LE(t));t+=8;let u=BigInt(e.readBigUInt64LE(t));t+=8;let m=e.readUInt32LE(t);t+=4;let d=1===e[t],f=e[t+=1];return{owner:r,agentKey:i,encryptionPubkey:a,createdAt:o,updatedAt:s,memoryCount:l,totalMemorySize:c,stakedAmount:u,rewardPoints:m,isActive:d,bump:f}}catch(e){throw console.error("Error parsing vault:",e),Error("Failed to parse vault data")}}parseProfile(e,t){try{let t=8,r=new n.PublicKey(e.slice(t,t+32));t+=32;let i=new n.PublicKey(e.slice(t,t+32));t+=32;let a=new n.PublicKey(e.slice(t,t+32));t+=32;let o=e.readUInt32LE(t);t+=4;let s=e.slice(t,t+o).toString("utf-8");t+=o;let l=e.readUInt32LE(t);t+=4;let c=e.slice(t,t+l).toString("utf-8"),u=c?c.split(","):[];t+=l;let m=e.readUInt32LE(t);t+=4;let d=e.readUInt32LE(t);t+=4;let f=BigInt(e.readBigUInt64LE(t));t+=8;let g=BigInt(e.readBigUInt64LE(t));t+=8;let y=BigInt(e.readBigUInt64LE(t));t+=8;let h=1===e[t],p=e[t+=1];return{agentKey:r,owner:i,vault:a,name:s,capabilities:u,reputationScore:m,tasksCompleted:d,createdAt:f,updatedAt:g,lastTaskAt:y,isPublic:h,bump:p}}catch(e){throw console.error("Error parsing profile:",e),Error("Failed to parse profile data")}}constructor(e,t,r="confirmed",n={}){this.connection=e,this.programId=t||o,this.commitment=r,this.retryConfig={...l,...n},this.transactionCallbacks=new Map}}async function u(e){let t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t);return new Uint8Array(r)}}}]);